<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ðŸ“± QR Code Scanner</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap');

    * { box-sizing: border-box; }
    body {
      margin: 0;
      background: linear-gradient(135deg, #6a11cb, #2575fc);
      font-family: 'Montserrat', sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem 1rem;
      color: white;
    }

    h1 {
      font-size: 2rem;
      margin-bottom: 1rem;
    }

    #reader {
      width: 100%;
      max-width: 400px;
      aspect-ratio: 1 / 1;
      background: black;
      border-radius: 12px;
      overflow: hidden;
    }

    #result {
      margin-top: 1rem;
      padding: 1rem;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      text-align: center;
      font-weight: bold;
      min-height: 2.5rem;
    }

    #result.success { color: #00ffae; }
    #result.error { color: #ff6b6b; }

    .buttons {
      margin-top: 1rem;
      display: flex;
      gap: 1rem;
    }

    button {
      padding: 0.7rem 1.2rem;
      font-size: 1rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
    }

    #start-button {
      background: #00c897;
      color: white;
    }

    #stop-button {
      background: #e74c3c;
      color: white;
    }

    #stop-button:disabled,
    #start-button:disabled {
      background: #888;
      cursor: not-allowed;
    }
  </style>
  <!-- Include html5-qrcode library -->
  <script src="https://unpkg.com/html5-qrcode@2.3.10/html5-qrcode.min.js"></script>
</head>
<body>

  <h1>ðŸ“± QR Code Scanner</h1>

  <div id="reader"></div>
  <div id="result">Click "Start Scanning" to begin</div>

  <div class="buttons">
    <button id="start-button">Start Scanning</button>
    <button id="stop-button" disabled>Stop Scanning</button>
  </div>

  <script>
    const resultDiv = document.getElementById('result');
    const startBtn = document.getElementById('start-button');
    const stopBtn = document.getElementById('stop-button');

    let html5QrCode;
    let scanning = false;

    function isValidUrl(string) {
      try {
        const url = new URL(string);
        return url.protocol === "http:" || url.protocol === "https:";
      } catch (_) {
        return false;
      }
    }

    const onScanSuccess = async (decodedText, decodedResult) => {
      if (!scanning) return;
      scanning = false;

      if (isValidUrl(decodedText)) {
        resultDiv.className = 'success';
        resultDiv.textContent = `Valid URL scanned: ${decodedText}`;
        window.open(decodedText, '_blank');
      } else {
        resultDiv.className = 'error';
        resultDiv.textContent = `Scanned content is not a URL: ${decodedText}`;
      }

      try {
        await html5QrCode.stop();
        await html5QrCode.clear();
      } catch (err) {
        console.error('Error stopping scanner:', err);
      }

      startBtn.disabled = false;
      stopBtn.disabled = true;
    };

    const onScanFailure = error => {
      // Ignored for now
    };

    startBtn.addEventListener('click', async () => {
      if (scanning) return;
      scanning = true;

      if (!Html5Qrcode.getCameras) {
        resultDiv.className = 'error';
        resultDiv.textContent = "Camera access is not supported in this browser.";
        scanning = false;
        return;
      }

      try {
        const cameras = await Html5Qrcode.getCameras();
        if (!cameras || !cameras.length) {
          resultDiv.className = 'error';
          resultDiv.textContent = "No camera devices found.";
          scanning = false;
          return;
        }

        const backCamera = cameras.find(cam => cam.label.toLowerCase().includes('back')) || cameras[0];

        html5QrCode = new Html5Qrcode("reader");

        await html5QrCode.start(
          { deviceId: { exact: backCamera.deviceId } },
          {
            fps: 10,
            qrbox: { width: 250, height: 250 }
          },
          onScanSuccess,
          onScanFailure
        );

        startBtn.disabled = true;
        stopBtn.disabled = false;
        resultDiv.className = '';
        resultDiv.textContent = "Scanning... Point your camera at a QR code.";

      } catch (err) {
        resultDiv.className = 'error';
        resultDiv.textContent = `Error starting scan: ${err}`;
        scanning = false;
        startBtn.disabled = false;
        stopBtn.disabled = true;
      }
    });

    stopBtn.addEventListener('click', async () => {
      if (!scanning || !html5QrCode) return;

      try {
        await html5QrCode.stop();
        await html5QrCode.clear();
        scanning = false;
        startBtn.disabled = false;
        stopBtn.disabled = true;
        resultDiv.className = '';
        resultDiv.textContent = "Scanning stopped.";
      } catch (err) {
        resultDiv.className = 'error';
        resultDiv.textContent = `Error stopping scan: ${err}`;
      }
    });
  </script>
</body>
</html>
